{"remainingRequest":"C:\\Users\\roemer\\Documents\\2019\\stay-manager\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\roemer\\Documents\\2019\\stay-manager\\src\\components\\form-stay.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\roemer\\Documents\\2019\\stay-manager\\src\\components\\form-stay.vue","mtime":1577281353744},{"path":"C:\\Users\\roemer\\Documents\\2019\\stay-manager\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576626834856},{"path":"C:\\Users\\roemer\\Documents\\2019\\stay-manager\\node_modules\\babel-loader\\lib\\index.js","mtime":1576626834590},{"path":"C:\\Users\\roemer\\Documents\\2019\\stay-manager\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1576626834856},{"path":"C:\\Users\\roemer\\Documents\\2019\\stay-manager\\node_modules\\vue-loader\\lib\\index.js","mtime":1576626847671}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgc3RheTogdGhpcy4kc3RvcmUuc3RhdGUuc3RheQ0KICAgIH07DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgY29tcHV0ZWRTdGF5OiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnN0YXkpOw0KICAgIH0sDQogICAgc3RheU5pZ2h0QXJyYXk6IGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIHRlbXBTdGF5TmlnaHRBcnJheSA9IFtdOw0KICAgICAgdmFyIHRlbXBBcnJpdmFsRGF0ZSA9IG1vbWVudCh0aGlzLnN0YXkuYXJyaXZhbERhdGV0aW1lKTsNCiAgICAgIHZhciB0ZW1wRGVwYXJ0dXJlRGF0ZSA9IG1vbWVudCh0aGlzLnN0YXkuZGVwYXJ0dXJlRGF0ZXRpbWUpOw0KDQogICAgICB2YXIgaSA9IDA7DQogICAgICB3aGlsZSAodGVtcEFycml2YWxEYXRlIDwgdGVtcERlcGFydHVyZURhdGUpIHsNCiAgICAgICAgdmFyIHRlbXBTdGF5TmlnaHRPYmplY3QgPSB7DQogICAgICAgICAgaWQ6IGksDQogICAgICAgICAgZGF0ZTogdGVtcEFycml2YWxEYXRlLnVuaXgoKSwNCiAgICAgICAgICBndWVzdHM6IHRoaXMuc3RheS5iYXNlR3Vlc3RzDQogICAgICAgIH07DQogICAgICAgIHRlbXBTdGF5TmlnaHRBcnJheS5wdXNoKHRlbXBTdGF5TmlnaHRPYmplY3QpOw0KICAgICAgICB0ZW1wQXJyaXZhbERhdGUgPSB0ZW1wQXJyaXZhbERhdGUuYWRkKDEsICJkYXlzIik7DQogICAgICAgIGkrKzsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0ZW1wU3RheU5pZ2h0QXJyYXk7DQogICAgfQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgaHVtYW5Gb3JtYXREYXRldGltZTogZnVuY3Rpb24oZGF0ZSkgew0KICAgICAgcmV0dXJuIG1vbWVudChkYXRlKS5mb3JtYXQoImRkZCBEIE1NTSBZWVlZIC0gSEg6bW0iKTsNCiAgICB9LA0KICAgIGVkaXROaWdodENvbnRlbnRUZXh0Rm9ybWF0OiBmdW5jdGlvbihkYXRlKSB7DQogICAgICByZXR1cm4gbW9tZW50LnVuaXgoZGF0ZSkuZm9ybWF0KCJkZGRkIEQiKTsNCiAgICB9DQogIH0sDQogIHdhdGNoOiB7DQogICAgY29tcHV0ZWRTdGF5OiB7DQogICAgICAvLyBVcGRhdGUgZGVwYXJ0dXJlIGRhdGUgKG5vdCB0aW1lKSBpZiB0aGUgYXJyaXZhbCBkYXRlIGNoYW5nZXMNCiAgICAgIGRlZXA6IHRydWUsDQogICAgICBoYW5kbGVyOiBmdW5jdGlvbihuZXdTdGF5LCBvbGRTdGF5KSB7DQogICAgICAgIHZhciBvbGRTdGF5QXJyaXZhbERhdGV0aW1lID0gbW9tZW50KG9sZFN0YXkuYXJyaXZhbERhdGV0aW1lKTsNCiAgICAgICAgdmFyIG9sZFN0YXlEZXBhcnR1cmVEYXRldGltZSA9IG1vbWVudChvbGRTdGF5LmRlcGFydHVyZURhdGV0aW1lKTsNCiAgICAgICAgdmFyIG5ld1N0YXlBcnJpdmFsRGF0ZXRpbWUgPSBtb21lbnQobmV3U3RheS5hcnJpdmFsRGF0ZXRpbWUpOw0KICAgICAgICB2YXIgbmV3U3RheURlcGFydHVyZURhdGV0aW1lID0gbW9tZW50KG5ld1N0YXkuZGVwYXJ0dXJlRGF0ZXRpbWUpOw0KICAgICAgICBpZiAoDQogICAgICAgICAgKG9sZFN0YXlBcnJpdmFsRGF0ZXRpbWUuZm9ybWF0KCJMTCIpICE9PQ0KICAgICAgICAgICAgbmV3U3RheUFycml2YWxEYXRldGltZS5mb3JtYXQoIkxMIikpICYNCiAgICAgICAgICAob2xkU3RheURlcGFydHVyZURhdGV0aW1lLmZvcm1hdCgiTEwiKSA9PQ0KICAgICAgICAgICAgbmV3U3RheURlcGFydHVyZURhdGV0aW1lLmZvcm1hdCgiTEwiKSkNCiAgICAgICAgKSB7DQogICAgICAgICAgdGhpcy5zdGF5LmRlcGFydHVyZURhdGV0aW1lID0gbmV3U3RheUFycml2YWxEYXRldGltZQ0KICAgICAgICAgICAgLmhvdXIob2xkU3RheURlcGFydHVyZURhdGV0aW1lLmhvdXIoKSkNCiAgICAgICAgICAgIC5taW51dGUob2xkU3RheURlcGFydHVyZURhdGV0aW1lLm1pbnV0ZSgpKQ0KICAgICAgICAgICAgLnRvRGF0ZSgpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuc3RheS5zdGF5TmlnaHRBcnJheSA9IHRoaXMuc3RheU5pZ2h0QXJyYXk7DQogICAgICB9DQogICAgfQ0KICB9DQp9Ow0K"},{"version":3,"sources":["form-stay.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgIA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"form-stay.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <!-- FORM SECTION TITLE -->\r\n    <h6 class=\"title is-6\">Nuitées</h6>\r\n    <!-- ARRIVAL -->\r\n    <b-field label=\"Check-in\" label-position=\"on-border\">\r\n      <b-datetimepicker\r\n        icon-pack=\"fas\"\r\n        v-model=\"stay.arrivalDatetime\"\r\n        ref=\"arrivalDatetimePicker\"\r\n        placeholder=\"Check-in\"\r\n        :timepicker=\"{ incrementMinutes: 15 }\"\r\n        :datetime-formatter=\"humanFormatDatetime\"\r\n        :mobile-native=\"false\"\r\n      >\r\n        <template slot=\"right\">\r\n          <button\r\n            class=\"button is-success\"\r\n            @click=\"$refs.arrivalDatetimePicker.toggle()\"\r\n          >\r\n            <b-icon pack=\"fas\" icon=\"check\"></b-icon>\r\n            <span>Valider</span>\r\n          </button>\r\n        </template>\r\n      </b-datetimepicker>\r\n    </b-field>\r\n    <!-- DEPARTURE -->\r\n    <b-field label=\"Check-out\" label-position=\"on-border\">\r\n      <b-datetimepicker\r\n        icon-pack=\"fas\"\r\n        v-model=\"stay.departureDatetime\"\r\n        ref=\"departureDatetimePicker\"\r\n        placeholder=\"Check-out\"\r\n        :timepicker=\"{ incrementMinutes: 15 }\"\r\n        :datetime-formatter=\"humanFormatDatetime\"\r\n        :mobile-native=\"false\"\r\n      >\r\n        <template slot=\"right\">\r\n          <button\r\n            class=\"button is-success\"\r\n            @click=\"$refs.departureDatetimePicker.toggle()\"\r\n          >\r\n            <b-icon pack=\"fas\" icon=\"check\"></b-icon>\r\n            <span>Valider</span>\r\n          </button>\r\n        </template>\r\n      </b-datetimepicker>\r\n    </b-field>\r\n\r\n    <!-- GUESTS -->\r\n    <b-field\r\n      label=\"Invités payants\"\r\n      label-position=\"on-border\"\r\n      message=\"2 ans et plus\"\r\n    >\r\n      <b-numberinput\r\n        icon-pack=\"fas\"\r\n        v-model=\"stay.baseGuests\"\r\n        min=\"10\"\r\n        controlsPosition=\"compact\"\r\n      ></b-numberinput>\r\n    </b-field>\r\n\r\n    <!-- CHILDREN -->\r\n    <b-field label=\"Enfants\" label-position=\"on-border\">\r\n      <b-numberinput\r\n        icon-pack=\"fas\"\r\n        v-model=\"stay.children\"\r\n        min=\"0\"\r\n        controlsPosition=\"compact\"\r\n      ></b-numberinput>\r\n    </b-field>\r\n\r\n    <!-- PETS -->\r\n    <b-field label=\"Animaux de compagnie\" label-position=\"on-border\">\r\n      <b-numberinput\r\n        icon-pack=\"fas\"\r\n        v-model=\"stay.pets\"\r\n        min=\"0\"\r\n        controlsPosition=\"compact\"\r\n      ></b-numberinput>\r\n    </b-field>\r\n\r\n    <!-- GUEST INFO -->\r\n    <b-field label=\"Informations supplémentaires\">\r\n      <b-input v-model=\"stay.guestInfo\" type=\"textarea\"></b-input>\r\n    </b-field>\r\n\r\n    <!-- GUEST DETAILED CONTROLS -->\r\n    <b-collapse :open=\"false\" class=\"card\" aria-id=\"editNightContent\">\r\n      <div\r\n        slot=\"trigger\"\r\n        class=\"card-header\"\r\n        role=\"button\"\r\n        aria-controls=\"editNightContent\"\r\n      >\r\n        <p class=\"card-header-title\">\r\n          {{ this.stay.stayNightArray.length }} nights\r\n        </p>\r\n        <a class=\"card-header-icon\">\r\n          <b-icon pack=\"fas\" icon=\"caret-down\"></b-icon>\r\n        </a>\r\n      </div>\r\n      <div class=\"card-content\">\r\n        <div class=\"content\">\r\n          <div v-for=\"night in stay.stayNightArray\" :key=\"night.id\">\r\n            <b-field grouped>\r\n              <b-field\r\n                style=\"width:100%;\"\r\n                :label=\"editNightContentTextFormat(night.date)\"\r\n                type=\"has-text-grey\"\r\n              >\r\n                <b-numberinput\r\n                  icon-pack=\"fas\"\r\n                  v-model=\"night.guests\"\r\n                  min=\"10\"\r\n                  controlsPosition=\"compact\"\r\n                ></b-numberinput>\r\n              </b-field>\r\n            </b-field>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </b-collapse>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport moment from \"moment\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      stay: this.$store.state.stay\r\n    };\r\n  },\r\n  computed: {\r\n    computedStay: function() {\r\n      return Object.assign({}, this.stay);\r\n    },\r\n    stayNightArray: function() {\r\n      var tempStayNightArray = [];\r\n      var tempArrivalDate = moment(this.stay.arrivalDatetime);\r\n      var tempDepartureDate = moment(this.stay.departureDatetime);\r\n\r\n      var i = 0;\r\n      while (tempArrivalDate < tempDepartureDate) {\r\n        var tempStayNightObject = {\r\n          id: i,\r\n          date: tempArrivalDate.unix(),\r\n          guests: this.stay.baseGuests\r\n        };\r\n        tempStayNightArray.push(tempStayNightObject);\r\n        tempArrivalDate = tempArrivalDate.add(1, \"days\");\r\n        i++;\r\n      }\r\n      return tempStayNightArray;\r\n    }\r\n  },\r\n  methods: {\r\n    humanFormatDatetime: function(date) {\r\n      return moment(date).format(\"ddd D MMM YYYY - HH:mm\");\r\n    },\r\n    editNightContentTextFormat: function(date) {\r\n      return moment.unix(date).format(\"dddd D\");\r\n    }\r\n  },\r\n  watch: {\r\n    computedStay: {\r\n      // Update departure date (not time) if the arrival date changes\r\n      deep: true,\r\n      handler: function(newStay, oldStay) {\r\n        var oldStayArrivalDatetime = moment(oldStay.arrivalDatetime);\r\n        var oldStayDepartureDatetime = moment(oldStay.departureDatetime);\r\n        var newStayArrivalDatetime = moment(newStay.arrivalDatetime);\r\n        var newStayDepartureDatetime = moment(newStay.departureDatetime);\r\n        if (\r\n          (oldStayArrivalDatetime.format(\"LL\") !==\r\n            newStayArrivalDatetime.format(\"LL\")) &\r\n          (oldStayDepartureDatetime.format(\"LL\") ==\r\n            newStayDepartureDatetime.format(\"LL\"))\r\n        ) {\r\n          this.stay.departureDatetime = newStayArrivalDatetime\r\n            .hour(oldStayDepartureDatetime.hour())\r\n            .minute(oldStayDepartureDatetime.minute())\r\n            .toDate();\r\n        }\r\n        this.stay.stayNightArray = this.stayNightArray;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n@import \"@/scss/_mystyles.scss\";\r\n</style>\r\n"]}]}